<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Microservices Architecture Scene</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script>
      AFRAME.registerComponent('start-button', {
  init: function () {
    this.el.addEventListener('click', function () {
      this.emit('start-data-flow');
    });
  }
});
      AFRAME.registerComponent('pause-button', {
  init: function () {
    this.el.addEventListener('click', function () {
      var vis = document.querySelector('[microservices-visualization]').components['microservices-visualization'];
      vis.isPaused = !vis.isPaused;
      this.setAttribute('text', 'value', vis.isPaused ? 'Resume' : 'Pause');
      if (!vis.isPaused) vis.animateNextStep();
    });
  }
});
     AFRAME.registerComponent('open-article', {
        init: function () {
          this.el.addEventListener('click', function () {
            window.open('https://dev.to/charity_everett/introduction-to-microservices-architecture-with-docker-and-kubernetes-3el8', '_blank');
          });
        }
      });

      AFRAME.registerComponent('service-interaction', {
        init: function () {
          this.el.addEventListener('click', function () {
            console.log('Service clicked:', this.id);
          });
        }
      });
    </script>
  </head>
  <body>
    
      AFRAME.registerComponent('microservices-visualization', {
  init: function () {
    this.services = {
      client: this.el.querySelector('#client'),
      apiGateway: this.el.querySelector('#apiGateway'),
      authService: this.el.querySelector('#authService'),
      userService: this.el.querySelector('#userService'),
      productService: this.el.querySelector('#productService'),
      orderService: this.el.querySelector('#orderService'),
      paymentService: this.el.querySelector('#paymentService')
    };

    this.dataFlow = [
      { from: 'client', to: 'apiGateway', data: { action: "place_order", user_id: "12345", product_id: "67890", quantity: 2 } },
      { from: 'apiGateway', to: 'authService', data: { action: "authenticate", user_id: "12345", auth_token: "abcdef" } },
      { from: 'authService', to: 'apiGateway', data: { user_id: "12345", authenticated: true } },
      { from: 'apiGateway', to: 'userService', data: { action: "get_user_info", user_id: "12345" } },
      { from: 'userService', to: 'apiGateway', data: { user_id: "12345", address: "123 Main St", preferred_payment: "credit_card" } },
      { from: 'apiGateway', to: 'productService', data: { action: "check_product_availability", product_id: "67890", quantity: 2 } },
      { from: 'productService', to: 'apiGateway', data: { product_id: "67890", available: true, stock: 10 } },
      { from: 'apiGateway', to: 'orderService', data: { action: "create_order", user_id: "12345", product_id: "67890", quantity: 2, address: "123 Main St", payment: "credit_card" } },
      { from: 'orderService', to: 'apiGateway', data: { order_id: "A123", status: "pending_payment" } },
      { from: 'orderService', to: 'paymentService', data: { action: "process_payment", order_id: "A123", amount: 100.00, payment_method: "credit_card" } },
      { from: 'paymentService', to: 'orderService', data: { payment_status: "success", transaction_id: "TXN789" } },
      { from: 'orderService', to: 'apiGateway', data: { order_id: "A123", status: "completed" } },
      { from: 'apiGateway', to: 'client', data: { order_id: "A123", status: "completed", message: "Your order has been successfully placed!" } }
    ];

    this.currentStep = 0;
    this.isPaused = false;

    this.el.sceneEl.addEventListener('start-data-flow', this.startDataFlow.bind(this));
  },

  startDataFlow: function () {
    this.animateNextStep();
  },

  animateNextStep: function () {
    if (this.isPaused || this.currentStep >= this.dataFlow.length) return;

    var step = this.dataFlow[this.currentStep];
    var fromEl = this.services[step.from];
    var toEl = this.services[step.to];

    // Create a visual representation of data (e.g., a small sphere)
    var dataEl = document.createElement('a-sphere');
    dataEl.setAttribute('radius', '0.1');
    dataEl.setAttribute('color', 'yellow');
    dataEl.setAttribute('position', fromEl.getAttribute('position'));

    // Animate the data from the 'from' service to the 'to' service
    dataEl.setAttribute('animation', {
      property: 'position',
      to: toEl.getAttribute('position'),
      dur: 2000,
      easing: 'linear'
    });

    this.el.appendChild(dataEl);

    // Remove the data element after animation completes
    setTimeout(() => {
      this.el.removeChild(dataEl);
      this.currentStep++;
      this.animateNextStep();
    }, 2000);

    // Update the info panel with the current step's data
    this.updateInfoPanel(step.data);
  },

  updateInfoPanel: function (data) {
    // Update an info panel entity with the current data
    var infoPanel = document.querySelector('#infoPanel');
    infoPanel.setAttribute('text', {
      value: JSON.stringify(data, null, 2),
      width: 2
    });
  },

  pause: function () {
    this.isPaused = true;
  },

  resume: function () {
    this.isPaused = false;
    this.animateNextStep();
  },

  reset: function () {
    this.currentStep = 0;
    this.isPaused = false;
    var infoPanel = document.querySelector('#infoPanel');
    infoPanel.setAttribute('text', {
      value: 'Data flow reset. Click Start to begin.',
      width: 2
    });
  }
});
    </script>
  </head>
  <body>
    <a-scene loading-screen="dotsColor: #ffffff; backgroundColor: #000000">
      <a-assets>
        <img id="sky" crossorigin="anonymous" src="https://cdn.glitch.global/5cfc02c2-e08f-4e29-9383-05c3fa57335f/Microservice%20Skybox.png?v=1729023719252">
        <img id="article-preview" crossorigin="anonymous" src="https://cdn.glitch.global/5cfc02c2-e08f-4e29-9383-05c3fa57335f/MicroservicesPage.png?v=1729025756305">

      </a-assets>

      <!-- Environment -->
      <a-sky src="#sky"></a-sky>
      
      <!-- Article Screen -->
<a-entity position="0 1.6 4" rotation="0 180 0">
  <a-plane width="8" height="6" color="#CCC">
    <a-plane position="0 0 0.01" width="7.8" height="5.8" src="#article-preview" open-article></a-plane>
    <a-text value="Click to read full article" align="center" position="0 -2.9 0.1" width="8" color="#000"></a-text>
  </a-plane>
</a-entity>
     
      <!-- Microservices Visualization -->
     <a-entity position="2.908 2.210 -2.677" rotation="3.380 -20 -2.677" scale="0.67 0.67 0.67" microservices-visualization>
        <!-- Client -->
        <a-box position="0 2.15 0.25" depth="1.2" height="0.4" width="0.6" color="red" rotation="15 30 15" service-interaction="name: client"></a-box>
        <a-text value="Client" position="0 2.3 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <!-- API Gateway -->
        <a-box position="0 1.15 0.25" depth="1.2" height="0.4" width="0.6" color="blue" rotation="15 30 15" service-interaction="name: api-gateway"></a-box>
        <a-text value="API Gateway" position="0 1.3 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <!-- Services Row -->
        <a-box position="-1.5 0.15 0.25" depth="1.2" height="0.4" width="0.6" color="green" rotation="15 30 15" service-interaction="name: auth-service"></a-box>
        <a-text value="Auth Service" position="-1.5 0.3 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <a-box position="-0.5 0.15 0.25" depth="1.2" height="0.4" width="0.6" color="yellow" rotation="15 30 15" service-interaction="name: user-service"></a-box>
        <a-text value="User Service" position="-0.5 0.3 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <a-box position="0.5 0.15 0.25" depth="1.2" height="0.4" width="0.6" color="purple" rotation="15 30 15" service-interaction="name: product-service"></a-box>
        <a-text value="Product Service" position="0.5 0.3 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <a-box position="1.5 0.15 0.25" depth="1.2" height="0.4" width="0.6" color="orange" rotation="15 30 15" service-interaction="name: order-service"></a-box>
        <a-text value="Order Service" position="1.5 0.3 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <!-- Payment Services -->
        <a-box position="1 -0.85 0.25" depth="1.2" height="0.4" width="0.6" color="pink" rotation="15 30 15" service-interaction="name: payment-service"></a-box>
        <a-text value="Payment Service" position="1 -0.7 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <a-box position="2 -0.85 0.25" depth="1.2" height="0.4" width="0.6" color="cyan" rotation="15 30 15" service-interaction="name: external-payment"></a-box>
        <a-text value="External Payment" position="2 -0.7 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <!-- Databases -->
        <a-cylinder position="-0.5 -1 0" radius="0.25" height="0.5" color="lightgray" service-interaction="name: user-db"></a-cylinder>
        <a-text value="User DB" position="-0.5 -0.7 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <a-cylinder position="-1.5 -1 0" radius="0.25" height="0.5" color="lightgray" service-interaction="name: product-db"></a-cylinder>
        <a-text value="Product DB" position="-1.5 -0.7 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
        <a-cylinder position="-2.5 -1 0" radius="0.25" height="0.5" color="lightgray" service-interaction="name: order-db"></a-cylinder>
        <a-text value="Order DB" position="-2.5 -0.7 0.5" align="center" rotation="-15 30 0" scale="0.5 0.5 0.5"></a-text>
      </a-entity>

      <!-- Start Button -->
      <a-entity id="startButton" 
          geometry="primitive: plane; width: 1; height: 0.5"
          material="color: green"
          position="-1 2 -3"
          text="value: Start Data Flow; align: center; width: 4"
          start-button>
</a-entity>

      <!-- Pause Button -->
      <a-entity id="pauseButton" 
          geometry="primitive: plane; width: 1; height: 0.5"
          material="color: orange"
          position="1 2 -3"
          text="value: Pause; align: center; width: 4"
          pause-button>

        <!-- Info Panel -->
        <a-entity id="infoPanel"
          geometry="primitive: plane; width: 2; height: 2"
          material="color: white"
          position="0 0 -2"
          text="value: Data will appear here; width: 1.8; color: black; align: left">
</a-entity>
</a-entity>

      <!-- Camera and Cursor -->
      <a-camera position="0 1.6 0" rotation= "3.1412 -10 0">
        <a-cursor></a-cursor>
      </a-camera>
    </a-scene>
  </body>
</html>
