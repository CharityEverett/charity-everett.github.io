<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('multipolar-neuron', {
        init: function() {
          this.createHexagonalSoma();
          this.createDendrites();
          this.createAxon();
        },
        
        createHexagonalSoma: function() {
          // Create hexagonal prism for soma
          const soma = document.createElement('a-cylinder');
          soma.setAttribute('segments-radial', '6');
          soma.setAttribute('height', '0.3');
          soma.setAttribute('radius', '0.4');
          soma.setAttribute('color', '#ffdd88');
          soma.setAttribute('material', {
            roughness: 0.8,
            metalness: 0.2,
            opacity: 0.9
          });
          soma.setAttribute('rotation', '90 30 0');
          soma.setAttribute('animation', {
            property: 'scale',
            dir: 'alternate',
            dur: 2000,
            loop: true,
            to: '1.05 1.05 1.05'
          });
          
          // Inner nucleus (hexagonal)
          const nucleus = document.createElement('a-cylinder');
          nucleus.setAttribute('segments-radial', '6');
          nucleus.setAttribute('height', '0.2');
          nucleus.setAttribute('radius', '0.2');
          nucleus.setAttribute('color', '#ffcccc');
          nucleus.setAttribute('rotation', '90 30 0');
          nucleus.setAttribute('animation', {
            property: 'scale',
            dir: 'alternate',
            dur: 2000,
            loop: true,
            to: '1.05 1.05 1.05'
          });
          
          this.el.appendChild(soma);
          this.el.appendChild(nucleus);
        },
        
        createDendrites: function() {
  // Create upward-biased dendrites from top portion
  for (let i = 0; i < 6; i++) {
    // Restrict angles to upper portion (between -60 and 60 degrees)
    const angle = (Math.PI/3) * (i - 2.5);
    const yBias = 0.6; // Stronger upward bias
    
    const dendrite = document.createElement('a-entity');
    const end = {
      x: Math.cos(angle) * 0.8,
      y: Math.sin(angle) * 0.8 + yBias,
      z: 0
    };
    
    dendrite.setAttribute('line', {
      start: {x: 0, y: 0.2, z: 0}, // Start from upper portion of soma
      end: end,
      color: '#ffdd88',
      opacity: 0.9,
      width: 0.02
    });
    
    this.createOrganizedBranch(end, 3, angle);
    this.el.appendChild(dendrite);
  }
},

createOrganizedBranch: function(start, depth, baseAngle) {
  if (depth <= 0) return;
  
  const branchAngles = [-0.6, 0.6]; // Wider angle for more spread
  branchAngles.forEach(angleOffset => {
    const newAngle = baseAngle + angleOffset;
    const length = 0.4 / (depth + 0.5);
    
    const end = {
      x: start.x + Math.cos(newAngle) * length,
      y: start.y + Math.sin(newAngle) * length + 0.2,
      z: start.z
    };
    
    const branch = document.createElement('a-entity');
    branch.setAttribute('line', {
      start: start,
      end: end,
      color: '#ffdd88',
      opacity: 0.9,
      width: 0.01 / depth
    });
    
    this.el.appendChild(branch);
    this.createOrganizedBranch(end, depth - 1, newAngle);
  });
}

        createAxon: function() {
          // Thin central axon line
          const axonLine = document.createElement('a-entity');
          axonLine.setAttribute('line', {
            start: {x: 0, y: -0.4, z: 0},
            end: {x: 0, y: -2.4, z: 0},
            color: '#ffdd88',
            opacity: 0.9,
            width: 0.01
          });
          this.el.appendChild(axonLine);
          
          // Segmented cylinders
          const segments = 8;
          let currentY = -0.4;
          const spacing = 0.25;
          
          for (let i = 0; i < segments; i++) {
            const segment = document.createElement('a-cylinder');
            segment.setAttribute('height', '0.2');
            segment.setAttribute('radius', '0.08');
            segment.setAttribute('position', `0 ${currentY} 0`);
            segment.setAttribute('color', '#ffdd88');
            segment.setAttribute('material', {
              opacity: 0.9,
              transparent: true
            });
            this.el.appendChild(segment);
            currentY -= spacing;
          }
          
          // Terminal branches
          const terminalPositions = [
            {x: -0.4, y: currentY - 0.2, z: 0},
            {x: 0.4, y: currentY - 0.2, z: 0},
            {x: -0.2, y: currentY - 0.4, z: 0},
            {x: 0.2, y: currentY - 0.4, z: 0},
            {x: 0, y: currentY - 0.3, z: 0}
          ];
          
          terminalPositions.forEach(pos => {
            const branch = document.createElement('a-entity');
            branch.setAttribute('line', {
              start: {x: 0, y: currentY, z: 0},
              end: pos,
              color: '#ffdd88',
              width: 0.02
            });
            
            const terminal = document.createElement('a-sphere');
            terminal.setAttribute('radius', '0.05');
            terminal.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
            terminal.setAttribute('color', '#ffdd88');
            
            this.el.appendChild(branch);
            this.el.appendChild(terminal);
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-entity id="neuron" multipolar-neuron position="0 1.5 -3" scale="1.5 1.5 1.5"></a-entity>
      
      <a-camera position="0 0 0"></a-camera>
      
      <a-sky color="#001133"></a-sky>
      <a-light type="ambient" intensity="0.5"></a-light>
      <a-light type="directional" position="1 1 1" intensity="0.8"></a-light>
      <a-light type="point" position="-1 1 0" intensity="0.5"></a-light>
    </a-scene>
  </body>
</html>
