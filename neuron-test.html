<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('cursor-listener', {
        init: function() {
          this.el.addEventListener('click', function() {
            window.location.href = 'https://www.gobackfetchitxr.com';
          });
        }
      });

      AFRAME.registerComponent('multipolar-neuron', {
        init: function() {
          this.createHexagonalSoma();
          this.createDendrites();
          this.createAxon();
        },
        
        createHexagonalSoma: function() {
          const soma = document.createElement('a-cylinder');
          soma.setAttribute('segments-radial', '6');
          soma.setAttribute('height', '0.3');
          soma.setAttribute('radius', '0.4');
          soma.setAttribute('color', '#ffdd88');
          soma.setAttribute('material', {
            roughness: 0.8,
            metalness: 0.2,
            opacity: 0.9
          });
          soma.setAttribute('rotation', '90 30 0');
          
          // Add pulsing animation
          soma.setAttribute('animation', {
            property: 'scale',
            dir: 'alternate',
            dur: 1000,
            easing: 'easeInOutSine',
            loop: true,
            to: '1.1 1.1 1.1',
            from: '1 1 1'
          });
          
          const nucleus = document.createElement('a-cylinder');
          nucleus.setAttribute('segments-radial', '6');
          nucleus.setAttribute('height', '0.2');
          nucleus.setAttribute('radius', '0.2');
          nucleus.setAttribute('color', '#ffcccc');
          nucleus.setAttribute('rotation', '90 30 0');
          
          // Add nucleus animation
          nucleus.setAttribute('animation', {
            property: 'scale',
            dir: 'alternate',
            dur: 1000,
            easing: 'easeInOutSine',
            loop: true,
            to: '1.05 1.05 1.05',
            from: '1 1 1'
          });

          const portal = document.createElement('a-cylinder');
          portal.setAttribute('segments-radial', '6');
          portal.setAttribute('height', '0.01');
          portal.setAttribute('radius', '0.375');
          portal.setAttribute('position', '0.118 -0.021 0.155');
          portal.setAttribute('material', {
            src: '#gif1',
            opacity: 0.9,
            transparent: true,
            emissive: '#aaddff',
            emissiveIntensity: 0.5,
            rotation: 45
          });
          portal.setAttribute('rotation', '90 30 0');
          portal.setAttribute('class', 'clickable');
          portal.setAttribute('cursor-listener', '');
          
          this.el.appendChild(soma);
          this.el.appendChild(nucleus);
          this.el.appendChild(portal);
        },
        
        createDendrites: function() {
          const vertices = [
            { x: 0.35, y: 0.2 },
            { x: 0, y: 0.4 },
            { x: -0.35, y: 0.2 },
            { x: -0.35, y: -0.2 },
            { x: 0.35, y: -0.2 }
          ];
          
          vertices.forEach(vertex => {
            const branchCount = (vertex.y > 0) ? 3 : 2;
            for (let i = 0; i < branchCount; i++) {
              const angle = Math.atan2(vertex.y, vertex.x) + (Math.random() - 0.5) * 0.3;
              const length = 0.6 + Math.random() * 0.3;
              
              const end = {
                x: vertex.x + Math.cos(angle) * length,
                y: vertex.y + Math.sin(angle) * length,
                z: (Math.random() - 0.5) * 0.2
              };
              
              const dendrite = document.createElement('a-entity');
              dendrite.setAttribute('line', {
                start: vertex,
                end: end,
                color: '#ffdd88',
                opacity: 0.9,
                width: 0.015
              });

              // Add reaching animation
              dendrite.setAttribute('animation__stretch', {
                property: 'scale',
                dir: 'alternate',
                dur: 2000 + Math.random() * 1000,
                easing: 'easeInOutSine',
                loop: true,
                from: '1 1 1',
                to: '1.1 1.1 1.1'
              });

              // Add glow effect
              dendrite.setAttribute('animation__glow', {
                property: 'line.opacity',
                dir: 'alternate',
                dur: 1500,
                easing: 'easeInOutSine',
                loop: true,
                from: 0.6,
                to: 1.0
              });

              // Create small sphere at dendrite tip
              const tip = document.createElement('a-sphere');
              tip.setAttribute('radius', '0.01');
              tip.setAttribute('position', `${end.x} ${end.y} ${end.z}`);
              tip.setAttribute('color', '#ffdd88');
              tip.setAttribute('animation', {
                property: 'scale',
                dir: 'alternate',
                dur: 1000,
                easing: 'easeInOutSine',
                loop: true,
                from: '1 1 1',
                to: '1.3 1.3 1.3'
              });
              
              this.createBranches(end, 2, angle);
              this.el.appendChild(dendrite);
              this.el.appendChild(tip);
            }
          });
        },

        createBranches: function(start, depth, baseAngle) {
          if (depth <= 0) return;
          
          [-0.7, 0.7].forEach(angleOffset => {
            const newAngle = baseAngle + angleOffset + (Math.random() - 0.5) * 0.2;
            const length = (0.3 / depth) * (0.8 + Math.random() * 0.4);
            
            const end = {
              x: start.x + Math.cos(newAngle) * length,
              y: start.y + Math.sin(newAngle) * length,
              z: start.z + (Math.random() - 0.5) * 0.1
            };
            
            const branch = document.createElement('a-entity');
            branch.setAttribute('line', {
              start: start,
              end: end,
              color: '#ffdd88',
              opacity: 0.9,
              width: 0.01 / depth
            });
            
            this.el.appendChild(branch);
            this.createBranches(end, depth - 1, newAngle);
          });
        },

        createAxon: function() {
          const axonLine = document.createElement('a-entity');
          axonLine.setAttribute('line', {
            start: {x: 0, y: -0.4, z: 0},
            end: {x: 0, y: -1.2, z: 0},
            color: '#ffdd88',
            opacity: 1.0,
            width: 0.04
          });
          this.el.appendChild(axonLine);

          const segments = 4;
          let currentY = -0.4;
          const spacing = 0.25;
          for (let i = 0; i < segments; i++) {
            const segment = document.createElement('a-cylinder');
            segment.setAttribute('height', '0.2');
            segment.setAttribute('radius', '0.08');
            segment.setAttribute('position', `0 ${currentY} 0`);
            segment.setAttribute('color', '#ffdd88');
            this.el.appendChild(segment);
            currentY -= spacing;
          }

          // Add propagating signal animation
          const signal = document.createElement('a-sphere');
          signal.setAttribute('radius', '0.04');
          signal.setAttribute('color', '#ffffff');
          signal.setAttribute('opacity', '0.6');
          signal.setAttribute('animation', {
            property: 'position',
            dur: 1500,
            easing: 'linear',
            loop: true,
            from: '0 -0.4 0',
            to: '0 -1.2 0'
          });
          this.el.appendChild(signal);

          const terminalY = currentY + spacing;
          const mainBranches = [
            {angle: -45, length: 0.7},
            {angle: 45, length: 0.7}
          ];

          mainBranches.forEach(branch => {
            const radians = branch.angle * Math.PI / 180;
            const endX = Math.sin(radians) * branch.length;
            const endY = terminalY - Math.cos(radians) * branch.length;
            
            const mainBranch = document.createElement('a-entity');
            mainBranch.setAttribute('line', {
              start: {x: 0, y: terminalY, z: 0},
              end: {x: endX, y: endY, z: 0},
              color: '#ffdd88',
              width: 0.03
            });
            this.el.appendChild(mainBranch);

            const subBranches = [
              {angleOffset: -30, length: 0.5},
              {angleOffset: 30, length: 0.5}
            ];

            subBranches.forEach(subBranch => {
              const subAngle = (branch.angle + subBranch.angleOffset) * Math.PI / 180;
              const subEndX = endX + Math.sin(subAngle) * subBranch.length;
              const subEndY = endY - Math.cos(subAngle) * subBranch.length;

              const terminal = document.createElement('a-entity');
              terminal.setAttribute('line', {
                start: {x: endX, y: endY, z: 0},
                end: {x: subEndX, y: subEndY, z: 0},
                color: '#ffdd88',
                width: 0.02
              });
              this.el.appendChild(terminal);

              const bouton = document.createElement('a-sphere');
              bouton.setAttribute('radius', '0.02');
              bouton.setAttribute('position', `${subEndX} ${subEndY} 0`);
              bouton.setAttribute('color', '#ffdd88');
              
              // Add terminal bouton animation
              bouton.setAttribute('animation', {
                property: 'scale',
                dir: 'alternate',
                dur: 1000,
                easing: 'easeInOutSine',
                loop: true,
                from: '1 1 1',
                to: '1.2 1.2 1.2'
              });
              
              this.el.appendChild(bouton);
            });
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="gif1" 
             crossorigin="anonymous" 
             src="https://cdn.glitch.global/5cfc02c2-e08f-4e29-9383-05c3fa57335f/Microservices%20Architecture%20Animated%20Infographic.gif?v=1728249005775" />
      </a-assets>
      
      <a-entity id="neuron" multipolar-neuron position="0 1.5 -3" scale="1.5 2.0 1.5"></a-entity>
      
      <a-camera position="0 0 0">
        <a-cursor raycaster="objects: .clickable"></a-cursor>
      </a-camera>
      
      <a-sky color="#001133"></a-sky>
      <a-light type="ambient" intensity="0.5"></a-light>
      <a-light type="directional" position="1 1 1" intensity="0.8"></a-light>
      <a-light type="point" position="-1 1 0" intensity="0.5"></a-light>
    </a-scene>
  </body>
</html>
